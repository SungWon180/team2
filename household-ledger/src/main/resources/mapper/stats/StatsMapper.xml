<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.team2.householdledger.stats.mapper.StatsMapper">

    <!-- 
        [TIP] 통계 쿼리 작성 가이드
        GROUP BY 절과 SUM() 함수를 적극 활용하세요.
        fn_get_comm_nm() 함수로 코드명을 변환하세요.
    -->

    <select id="selectCategoryStats" resultType="StatsDTO"> SELECT comm_cd , fn_get_comm_nm(comm_cd)
        AS categoryNm , SUM(amount) AS totalAmount FROM ledgers WHERE user_no = #{userNo} AND
        DATE_FORMAT(trans_dt, '%Y-%m') = #{yearMonth} AND status_cd = 'Y'  <!-- 지출(EXP)만 조회하거나 수입(INC)만 조회하도록 조건 추가 필요 --> GROUP BY comm_cd </select>

    <select id="selectMonthlyStats" resultType="StatsDTO">
        <!-- TODO: 월별 수입/지출을 한 번에 뽑거나 각각 쿼리 작성 --> SELECT DATE_FORMAT(trans_dt, '%Y-%m') AS
        month , SUM(CASE WHEN comm_cd LIKE 'INC%' THEN amount ELSE 0 END) AS incomeSum , SUM(CASE
        WHEN comm_cd LIKE 'EXP%' THEN amount ELSE 0 END) AS expenseSum FROM ledgers WHERE user_no =
        #{userNo} AND DATE_FORMAT(trans_dt, '%Y') = #{year} AND status_cd = 'Y' GROUP BY
        DATE_FORMAT(trans_dt, '%Y-%m') ORDER BY month ASC </select>

</mapper>